---
import type { CollectionEntry } from "astro:content";
import PostPreviewCard from "./PostPreviewCard.astro";
import NotePreviewCard from "./NotePreviewCard.astro";

interface Props {
  posts: CollectionEntry<"blog" | "notes">[];
}

const { posts } = Astro.props;

const sortedPosts = posts.sort((a, b) => {
  if (a.collection === "blog" && b.collection === "blog") {
    return b.data.publishedDate.valueOf() - a.data.publishedDate.valueOf();
  } else {
    if (a.data.title < b.data.title) {
      return -1;
    } else if (a.data.title > b.data.title) {
      return 1;
    } else {
      return 0;
    }
  }
});
---

<div class="posts-wrapper">
  {
    sortedPosts.map((post) => (
      <div>
        {post.collection === "blog" ? (
          <PostPreviewCard blogBit={post} />
        ) : (
          <NotePreviewCard noteInfo={post} />
        )}
      </div>
    ))
  }
</div>

<style>
  .posts-wrapper {
    container-type: inline-size;
    display: grid;
    gap: 2rem;
    margin-bottom: 3rem;

    @media (min-width: 768px) {
      & {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (min-width: 1280px) {
      & {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  }

  .posts-wrapper > div {
    @media (min-width: 768px) {
      & {
        grid-area: span 1 / span 2;
      }
    }

    @media (min-width: 1280px) {
      & {
        grid-area: span 1 / span 1;
      }
    }
  }

  .posts-wrapper div:last-child:nth-child(odd) {
    @media (min-width: 768px) {
      & {
        grid-column: 2 / span 2;
      }
    }

    @media (min-width: 1280px) {
      & {
        grid-column: span 1;
      }
    }
  }
</style>
